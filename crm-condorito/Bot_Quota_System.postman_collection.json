{
	"info": {
		"_postman_id": "bot-quota-system-2024",
		"name": "游뱄 Sistema de Cuotas del Bot - CRM Condorito",
		"description": "Colecci칩n completa para gestionar y probar el sistema de cuotas de respuestas autom치ticas del bot de WhatsApp.",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "游댐 Autenticaci칩n",
			"item": [
				{
					"name": "Login - Obtener Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    pm.environment.set('jwt_token', response.accessToken);",
									"    console.log('Token JWT guardado:', response.accessToken);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"clientCode\": \"CLI001\",\n  \"password\": \"password123\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"login"
							]
						},
						"description": "Hacer login y obtener token JWT. El token se guarda autom치ticamente en la variable de entorno 'jwt_token'."
					},
					"response": []
				}
			],
			"description": "Endpoints de autenticaci칩n para obtener tokens JWT"
		},
		{
			"name": "游늵 Consultas de Cuota",
			"item": [
				{
					"name": "Ver Estado Actual de Cuota",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/messages/bot/quota",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"messages",
								"bot",
								"quota"
							]
						},
						"description": "Obtiene el estado actual de la cuota del bot: uso, l칤mite, porcentaje, fecha de reset, etc."
					},
					"response": []
				},
				{
					"name": "Ver Historial de Uso (30 d칤as)",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/messages/bot/quota/history?days=30",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"messages",
								"bot",
								"quota",
								"history"
							],
							"query": [
								{
									"key": "days",
									"value": "30",
									"description": "N칰mero de d칤as hacia atr치s para el historial"
								}
							]
						},
						"description": "Obtiene el historial de uso del bot por d칤a durante los 칰ltimos 30 d칤as"
					},
					"response": []
				},
				{
					"name": "Ver Historial de Uso (7 d칤as)",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/messages/bot/quota/history?days=7",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"messages",
								"bot",
								"quota",
								"history"
							],
							"query": [
								{
									"key": "days",
									"value": "7"
								}
							]
						},
						"description": "Obtiene el historial de uso del bot por d칤a durante los 칰ltimos 7 d칤as"
					},
					"response": []
				}
			],
			"description": "Endpoints para consultar el estado y historial de cuotas del bot"
		},
		{
			"name": "丘뙖잺 Configuraci칩n de Cuota",
			"item": [
				{
					"name": "Configurar L칤mite - Plan Emprendedor (2500)",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"monthly_bot_limit\": 2500\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/messages/bot/quota",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"messages",
								"bot",
								"quota"
							]
						},
						"description": "Configura el l칤mite mensual del bot para el Plan Emprendedor (2,500 respuestas/mes)"
					},
					"response": []
				},
				{
					"name": "Configurar L칤mite - Plan Profesional (5000)",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"monthly_bot_limit\": 5000\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/messages/bot/quota",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"messages",
								"bot",
								"quota"
							]
						},
						"description": "Configura el l칤mite mensual del bot para el Plan Profesional (5,000 respuestas/mes)"
					},
					"response": []
				},
				{
					"name": "Configurar L칤mite - Plan Empresarial (15000)",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"monthly_bot_limit\": 15000\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/messages/bot/quota",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"messages",
								"bot",
								"quota"
							]
						},
						"description": "Configura el l칤mite mensual del bot para el Plan Empresarial (15,000 respuestas/mes)"
					},
					"response": []
				},
				{
					"name": "Configurar L칤mite Personalizado",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"monthly_bot_limit\": 10000\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/messages/bot/quota",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"messages",
								"bot",
								"quota"
							]
						},
						"description": "Configura un l칤mite personalizado para el bot. Cambia el valor seg칰n necesites."
					},
					"response": []
				}
			],
			"description": "Endpoints para configurar l칤mites de cuota seg칰n diferentes planes"
		},
		{
			"name": "游댃 Gesti칩n de Cuota",
			"item": [
				{
					"name": "Reset Manual del Contador",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "{{base_url}}/api/messages/bot/quota/reset",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"messages",
								"bot",
								"quota",
								"reset"
							]
						},
						"description": "Resetea manualmente el contador de uso del bot a 0. 칔til para testing o inicio de ciclo."
					},
					"response": []
				}
			],
			"description": "Endpoints para gestionar y resetear contadores de cuota"
		},
		{
			"name": "游빍 Testing y Validaciones",
			"item": [
				{
					"name": "Test - L칤mite Muy Bajo (para testing)",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"monthly_bot_limit\": 3\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/messages/bot/quota",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"messages",
								"bot",
								"quota"
							]
						},
						"description": "Configura un l칤mite muy bajo para probar r치pidamente el comportamiento cuando se excede la cuota"
					},
					"response": []
				},
				{
					"name": "Test - L칤mite Inv치lido (Negativo)",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"monthly_bot_limit\": -100\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/messages/bot/quota",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"messages",
								"bot",
								"quota"
							]
						},
						"description": "Prueba validaci칩n con un l칤mite inv치lido (negativo). Deber칤a devolver error 400."
					},
					"response": []
				},
				{
					"name": "Test - L칤mite Muy Alto",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"monthly_bot_limit\": 60000\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/messages/bot/quota",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"messages",
								"bot",
								"quota"
							]
						},
						"description": "Prueba configuraci칩n con l칤mite muy alto (superior a 50,000). Deber칤a devolver error."
					},
					"response": []
				}
			],
			"description": "Endpoints para testing de validaciones y casos extremos"
		},
		{
			"name": "游늶 Informaci칩n Adicional",
			"item": [
				{
					"name": "Ver Configuraci칩n General del Bot",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/messages/bot/config",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"messages",
								"bot",
								"config"
							]
						},
						"description": "Obtiene la configuraci칩n general del bot incluyendo horarios, d칤as activos, etc."
					},
					"response": []
				},
				{
					"name": "Ver Estad칤sticas de Mensajes",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/messages/stats",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"messages",
								"stats"
							]
						},
						"description": "Obtiene estad칤sticas generales de mensajes del cliente"
					},
					"response": []
				},
				{
					"name": "Ver Estado del Bot de Productos",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/messages/bot/products/status",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"messages",
								"bot",
								"products",
								"status"
							]
						},
						"description": "Verifica si la b칰squeda de productos est치 habilitada para el bot"
					},
					"response": []
				}
			],
			"description": "Endpoints informativos relacionados con el bot y mensajes"
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:3000",
			"type": "string"
		},
		{
			"key": "jwt_token",
			"value": "",
			"type": "string"
		}
	]
}
