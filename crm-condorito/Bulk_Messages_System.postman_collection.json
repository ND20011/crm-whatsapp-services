{
	"info": {
		"_postman_id": "bulk-messages-crm-condorito",
		"name": "üì§ Bulk Messages System - CRM Condorito",
		"description": "Colecci√≥n completa para probar el sistema de mensajes masivos (campa√±as) implementado en ETAPA 4.\n\n## üéØ **FUNCIONALIDADES INCLUIDAS:**\n- ‚úÖ CRUD completo de campa√±as\n- ‚úÖ Selecci√≥n inteligente de contactos\n- ‚úÖ Integraci√≥n con templates\n- ‚úÖ Preview de campa√±as\n- ‚úÖ Env√≠o con rate limiting\n- ‚úÖ Programaci√≥n de env√≠os\n- ‚úÖ Tracking en tiempo real\n- ‚úÖ Estad√≠sticas detalladas\n\n## üîë **CONFIGURACI√ìN:**\n1. Configurar variable `base_url` = `http://localhost:3000`\n2. Ejecutar **Login** para obtener JWT token\n3. Tener contactos y templates creados previamente\n4. El token se configurar√° autom√°ticamente\n\n## üìã **ORDEN RECOMENDADO DE TESTING:**\n1. **Authentication** ‚Üí Login\n2. **Campaign Management** ‚Üí Ver estad√≠sticas y estados\n3. **Contact Selection** ‚Üí Preview de selecci√≥n\n4. **Campaign CRUD** ‚Üí Crear, listar, actualizar\n5. **Campaign Execution** ‚Üí Enviar y cancelar\n6. **Advanced Features** ‚Üí Programaci√≥n y tracking",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "üîê Authentication",
			"item": [
				{
					"name": "Login - Get JWT Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    if (response.success && response.tokens && response.tokens.accessToken) {",
									"        pm.environment.set('jwt_token', response.tokens.accessToken);",
									"        console.log('‚úÖ JWT Token saved:', response.tokens.accessToken.substring(0, 50) + '...');",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"clientCode\": \"CLI001\",\n    \"password\": \"password123\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/login",
							"host": ["{{base_url}}"],
							"path": ["api", "auth", "login"]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "üìä Campaign Management",
			"item": [
				{
					"name": "Get Campaign Statistics",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/messages/campaigns/stats",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "campaigns", "stats"]
						}
					},
					"response": []
				},
				{
					"name": "Get Campaign Statuses",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/messages/campaigns/statuses",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "campaigns", "statuses"]
						}
					},
					"response": []
				},
				{
					"name": "Get All Campaigns",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/messages/campaigns?page=1&limit=20&search=&status=&sortBy=created_at&sortOrder=DESC",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "campaigns"],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "20"
								},
								{
									"key": "search",
									"value": ""
								},
								{
									"key": "status",
									"value": ""
								},
								{
									"key": "sortBy",
									"value": "created_at"
								},
								{
									"key": "sortOrder",
									"value": "DESC"
								}
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "üë• Contact Selection & Preview",
			"item": [
				{
					"name": "Preview - All Active Contacts",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"contact_filter\": {\n        \"is_active\": true,\n        \"search\": \"\",\n        \"limit\": 50\n    }\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/messages/campaigns/preview",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "campaigns", "preview"]
						}
					},
					"response": []
				},
				{
					"name": "Preview - Contacts by Search",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"contact_filter\": {\n        \"search\": \"Juan\",\n        \"limit\": 20\n    }\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/messages/campaigns/preview",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "campaigns", "preview"]
						}
					},
					"response": []
				},
				{
					"name": "Preview - Contacts by Tag",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"contact_filter\": {\n        \"tagId\": 1,\n        \"limit\": 30\n    },\n    \"template_id\": 1\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/messages/campaigns/preview",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "campaigns", "preview"]
						}
					},
					"response": []
				},
				{
					"name": "Preview - Specific Contact IDs",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"selected_contact_ids\": [1, 2, 3, 4, 5],\n    \"template_id\": 1\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/messages/campaigns/preview",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "campaigns", "preview"]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "üìù Campaign CRUD",
			"item": [
				{
					"name": "Create Campaign - Immediate Send",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    const response = pm.response.json();",
									"    if (response.success && response.data && response.data.id) {",
									"        pm.environment.set('immediate_campaign_id', response.data.id);",
									"        console.log('‚úÖ Immediate Campaign ID saved:', response.data.id);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"campaign_name\": \"Promoci√≥n Flash - Env√≠o Inmediato\",\n    \"template_id\": 1,\n    \"content\": \"üéâ ¬°Oferta especial! {nombre}, aprovech√° 50% de descuento en todos nuestros productos. ¬°Solo por hoy!\",\n    \"contact_filter\": {\n        \"is_active\": true,\n        \"limit\": 5\n    }\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/messages/campaigns",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "campaigns"]
						}
					},
					"response": []
				},
				{
					"name": "Create Campaign - Scheduled",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    const response = pm.response.json();",
									"    if (response.success && response.data && response.data.id) {",
									"        pm.environment.set('scheduled_campaign_id', response.data.id);",
									"        console.log('‚úÖ Scheduled Campaign ID saved:', response.data.id);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"campaign_name\": \"Newsletter Semanal\",\n    \"template_id\": 2,\n    \"content\": \"üì∞ Hola {nombre}, aqu√≠ tienes las novedades de esta semana. ¬°No te las pierdas!\",\n    \"scheduled_at\": \"2025-01-10T09:00:00.000Z\",\n    \"selected_contact_ids\": [1, 2, 3]\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/messages/campaigns",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "campaigns"]
						}
					},
					"response": []
				},
				{
					"name": "Create Campaign - Draft",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    const response = pm.response.json();",
									"    if (response.success && response.data && response.data.id) {",
									"        pm.environment.set('draft_campaign_id', response.data.id);",
									"        console.log('‚úÖ Draft Campaign ID saved:', response.data.id);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"campaign_name\": \"Campa√±a en Borrador\",\n    \"content\": \"Este es un mensaje en borrador que ser√° enviado m√°s tarde a {nombre}.\",\n    \"contact_filter\": {\n        \"search\": \"test\",\n        \"limit\": 10\n    }\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/messages/campaigns",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "campaigns"]
						}
					},
					"response": []
				},
				{
					"name": "Get Campaign by ID",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/messages/campaigns/{{immediate_campaign_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "campaigns", "{{immediate_campaign_id}}"]
						}
					},
					"response": []
				},
				{
					"name": "Update Campaign",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"campaign_name\": \"Campa√±a Actualizada\",\n    \"content\": \"Mensaje actualizado para {nombre}. ¬°Nuevas ofertas disponibles!\",\n    \"scheduled_at\": \"2025-01-11T10:00:00.000Z\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/messages/campaigns/{{draft_campaign_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "campaigns", "{{draft_campaign_id}}"]
						}
					},
					"response": []
				},
				{
					"name": "Delete Campaign",
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/messages/campaigns/{{draft_campaign_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "campaigns", "{{draft_campaign_id}}"]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "üöÄ Campaign Execution",
			"item": [
				{
					"name": "Send Campaign Immediately",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/messages/campaigns/{{scheduled_campaign_id}}/send",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "campaigns", "{{scheduled_campaign_id}}", "send"]
						}
					},
					"response": []
				},
				{
					"name": "Cancel Campaign",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/messages/campaigns/{{scheduled_campaign_id}}/cancel",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "campaigns", "{{scheduled_campaign_id}}", "cancel"]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "üîç Campaign Filters & Search",
			"item": [
				{
					"name": "Filter by Status - Completed",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/messages/campaigns?status=completed&page=1&limit=10",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "campaigns"],
							"query": [
								{
									"key": "status",
									"value": "completed"
								},
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "10"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Filter by Status - Sending",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/messages/campaigns?status=sending&page=1&limit=10",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "campaigns"],
							"query": [
								{
									"key": "status",
									"value": "sending"
								},
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "10"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Search Campaigns by Name",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/messages/campaigns?search=Promoci√≥n&page=1&limit=10",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "campaigns"],
							"query": [
								{
									"key": "search",
									"value": "Promoci√≥n"
								},
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "10"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Sort by Success Rate DESC",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/messages/campaigns?sortBy=success_rate&sortOrder=DESC&page=1&limit=10",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "campaigns"],
							"query": [
								{
									"key": "sortBy",
									"value": "success_rate"
								},
								{
									"key": "sortOrder",
									"value": "DESC"
								},
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "10"
								}
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "‚ö° Advanced Features",
			"item": [
				{
					"name": "Create Large Campaign - 100 Contacts",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"campaign_name\": \"Campa√±a Masiva - Test de Rendimiento\",\n    \"content\": \"üöÄ Hola {nombre}, este es un mensaje de prueba para una campa√±a masiva. ¬°Gracias por estar con nosotros!\",\n    \"contact_filter\": {\n        \"limit\": 100\n    }\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/messages/campaigns",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "campaigns"]
						}
					},
					"response": []
				},
				{
					"name": "Create Campaign with Template Variables",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"campaign_name\": \"Campa√±a con Variables\",\n    \"template_id\": 1,\n    \"content\": \"Hola {nombre}, hoy {fecha} a las {hora} queremos informarte sobre nuestras novedades. Tu tel√©fono {telefono} est√° registrado en nuestro sistema.\",\n    \"contact_filter\": {\n        \"limit\": 3\n    }\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/messages/campaigns",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "campaigns"]
						}
					},
					"response": []
				},
				{
					"name": "Legacy Endpoint - Send Bulk (Redirect)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"message\": \"Este endpoint redirige a las nuevas funcionalidades\",\n    \"contacts\": [1, 2, 3]\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/messages/send-bulk",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "send-bulk"]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "üß™ Error Testing",
			"item": [
				{
					"name": "Test Error - Create Campaign Without Contacts",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"campaign_name\": \"Campa√±a Sin Contactos\",\n    \"content\": \"Este mensaje no deber√≠a enviarse porque no hay contactos\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/messages/campaigns",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "campaigns"]
						}
					},
					"response": []
				},
				{
					"name": "Test Error - Create Campaign Without Name",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"campaign_name\": \"\",\n    \"content\": \"Mensaje sin nombre de campa√±a\",\n    \"selected_contact_ids\": [1]\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/messages/campaigns",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "campaigns"]
						}
					},
					"response": []
				},
				{
					"name": "Test Error - Invalid Template ID",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"campaign_name\": \"Campa√±a con Template Inv√°lido\",\n    \"template_id\": 99999,\n    \"content\": \"Este template no existe\",\n    \"selected_contact_ids\": [1]\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/messages/campaigns",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "campaigns"]
						}
					},
					"response": []
				},
				{
					"name": "Test Error - Send Campaign Already Completed",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/messages/campaigns/{{immediate_campaign_id}}/send",
							"host": ["{{base_url}}"],
							"path": ["api", "messages", "campaigns", "{{immediate_campaign_id}}", "send"]
						}
					},
					"response": []
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:3000",
			"type": "string"
		}
	]
}
