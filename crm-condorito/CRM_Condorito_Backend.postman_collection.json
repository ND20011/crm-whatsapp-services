{
	"info": {
		"_postman_id": "crm-condorito-backend-2024",
		"name": "CRM Condorito Backend - API Collection",
		"description": "Colecci√≥n completa de endpoints para el CRM Condorito Backend\n\nüöÄ **CARACTER√çSTICAS:**\n- Sistema de autenticaci√≥n JWT\n- Integraci√≥n WhatsApp completa\n- Gesti√≥n de mensajes y conversaciones\n- IA autom√°tica configurable\n- Health checks y monitoreo\n\nüìã **INSTRUCCIONES:**\n1. Configurar variables de entorno\n2. Ejecutar Login para obtener token\n3. El token se guarda autom√°ticamente\n4. Usar los dem√°s endpoints\n\nüîß **VARIABLES REQUERIDAS:**\n- base_url: http://localhost:3002\n- client_code: CLI001\n- password: demo123456",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "crm-condorito"
	},
	"item": [
		{
			"name": "üîê AUTENTICACI√ìN",
			"item": [
				{
					"name": "Login - Obtener Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Guardar token autom√°ticamente",
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    if (response.success && response.tokens) {",
									"        pm.environment.set('access_token', response.tokens.accessToken);",
									"        pm.environment.set('refresh_token', response.tokens.refreshToken);",
									"        console.log('‚úÖ Token guardado autom√°ticamente');",
									"    }",
									"} else {",
									"    console.log('‚ùå Error en login:', pm.response.text());",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"client_code\": \"{{client_code}}\",\n  \"password\": \"{{password}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"login"
							]
						},
						"description": "Autentica un cliente y obtiene tokens JWT.\n\n**Respuesta exitosa:**\n- access_token (v√°lido 24h)\n- refresh_token (v√°lido 7d)\n- Informaci√≥n del cliente\n- Estad√≠sticas b√°sicas"
					}
				},
				{
					"name": "Verificar Token",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/auth/verify",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"verify"
							]
						},
						"description": "Valida que el token de acceso sea v√°lido y no haya expirado."
					}
				},
				{
					"name": "Perfil del Cliente",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/auth/profile",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"profile"
							]
						},
						"description": "Obtiene informaci√≥n completa del cliente:\n- Datos personales\n- Estad√≠sticas\n- Sesi√≥n de WhatsApp\n- Configuraci√≥n del bot"
					}
				},
				{
					"name": "Logout",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/auth/logout",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"logout"
							]
						},
						"description": "Invalida el token actual y cierra la sesi√≥n."
					}
				},
				{
					"name": "Health Check - Auth",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/auth/health",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"health"
							]
						},
						"description": "Verifica el estado del m√≥dulo de autenticaci√≥n."
					}
				}
			],
			"description": "Endpoints para autenticaci√≥n y gesti√≥n de sesiones JWT."
		},
		{
			"name": "üì± WHATSAPP",
			"item": [
				{
					"name": "Conectar WhatsApp",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{}"
						},
						"url": {
							"raw": "{{base_url}}/api/whatsapp/connect",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"whatsapp",
								"connect"
							]
						},
						"description": "Inicia una nueva sesi√≥n de WhatsApp y genera QR code.\n\n**Proceso:**\n1. Ejecutar este endpoint\n2. Esperar 5 segundos\n3. Obtener QR code\n4. Escanear con WhatsApp\n5. Verificar estado"
					}
				},
				{
					"name": "QR Code (Imagen PNG)",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/whatsapp/qr/{{client_code}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"whatsapp",
								"qr",
								"{{client_code}}"
							]
						},
						"description": "**üñºÔ∏è DEVUELVE IMAGEN PNG DIRECTA**\n\nEste endpoint devuelve el QR code como imagen PNG que puedes:\n1. Ver directamente en Postman\n2. Guardar como archivo\n3. Escanear con WhatsApp\n\n**V√°lido por 5 minutos**"
					}
				},
				{
					"name": "QR Code (JSON Base64)",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/whatsapp/qr-json/{{client_code}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"whatsapp",
								"qr-json",
								"{{client_code}}"
							]
						},
						"description": "Devuelve el QR code como JSON con base64.\n\n√ösalo si necesitas procesar el QR program√°ticamente."
					}
				},
				{
					"name": "Estado de WhatsApp",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/whatsapp/status",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"whatsapp",
								"status"
							]
						},
						"description": "Obtiene el estado actual de WhatsApp:\n\n**Estados posibles:**\n- `not_initialized`: No conectado\n- `initializing`: Iniciando\n- `waiting_qr`: Esperando escaneo\n- `authenticated`: Autenticado\n- `ready`: ‚úÖ Conectado y listo\n- `disconnected`: Desconectado"
					}
				},
				{
					"name": "Enviar Mensaje de Texto",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"to\": \"5491123456789\",\n  \"message\": \"¬°Hola! Este es un mensaje de prueba desde el CRM Condorito üöÄ\",\n  \"isBot\": false\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/whatsapp/send-message",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"whatsapp",
								"send-message"
							]
						},
						"description": "Env√≠a un mensaje de texto a un contacto.\n\n**Par√°metros:**\n- `to`: N√∫mero de tel√©fono (con o sin c√≥digo de pa√≠s)\n- `message`: Texto del mensaje\n- `isBot`: false para mensaje manual, true para bot\n\n**Requiere WhatsApp conectado (status: ready)**"
					}
				},
				{
					"name": "Enviar Imagen",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "to",
									"value": "5491123456789",
									"type": "text"
								},
								{
									"key": "caption",
									"value": "Imagen enviada desde el CRM üì∏",
									"type": "text"
								},
								{
									"key": "image",
									"type": "file",
									"src": []
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/api/whatsapp/send-image",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"whatsapp",
								"send-image"
							]
						},
						"description": "Env√≠a una imagen a un contacto.\n\n**Par√°metros:**\n- `to`: N√∫mero de tel√©fono\n- `caption`: Descripci√≥n de la imagen (opcional)\n- `image`: Archivo de imagen (JPG, PNG, etc.)\n\n**Formatos soportados:** JPG, PNG, GIF, WebP"
					}
				},
				{
					"name": "Enviar Documento",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "to",
									"value": "5491123456789",
									"type": "text"
								},
								{
									"key": "filename",
									"value": "documento.pdf",
									"type": "text"
								},
								{
									"key": "document",
									"type": "file",
									"src": []
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/api/whatsapp/send-document",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"whatsapp",
								"send-document"
							]
						},
						"description": "Env√≠a un documento a un contacto.\n\n**Par√°metros:**\n- `to`: N√∫mero de tel√©fono\n- `filename`: Nombre del archivo\n- `document`: Archivo (PDF, DOC, XLS, etc.)"
					}
				},
				{
					"name": "Desconectar WhatsApp",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/whatsapp/disconnect",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"whatsapp",
								"disconnect"
							]
						},
						"description": "Desconecta la sesi√≥n actual de WhatsApp.\n\n**Nota:** Para reconectar, usar el endpoint 'Conectar WhatsApp'."
					}
				},
				{
					"name": "Estad√≠sticas WhatsApp",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/whatsapp/stats",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"whatsapp",
								"stats"
							]
						},
						"description": "Obtiene estad√≠sticas generales del servicio WhatsApp:\n- Total de clientes\n- Clientes conectados\n- Esperando QR\n- Desconectados"
					}
				},
				{
					"name": "Health Check - WhatsApp",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/whatsapp/health",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"whatsapp",
								"health"
							]
						},
						"description": "Verifica el estado del servicio WhatsApp."
					}
				}
			],
			"description": "Endpoints para gesti√≥n completa de WhatsApp: conexi√≥n, QR codes, env√≠o de mensajes y monitoreo."
		},
		{
			"name": "üí¨ MENSAJES Y CONVERSACIONES",
			"item": [
				{
					"name": "Listar Conversaciones",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/messages/conversations?limit=50&offset=0&archived=false",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"messages",
								"conversations"
							],
							"query": [
								{
									"key": "limit",
									"value": "50",
									"description": "N√∫mero de resultados (default: 50)"
								},
								{
									"key": "offset",
									"value": "0",
									"description": "Desplazamiento para paginaci√≥n"
								},
								{
									"key": "archived",
									"value": "false",
									"description": "Mostrar archivadas (true/false)"
								},
								{
									"key": "search",
									"value": "",
									"description": "Buscar por nombre o tel√©fono",
									"disabled": true
								}
							]
						},
						"description": "Lista todas las conversaciones del cliente con:\n- Informaci√≥n del contacto\n- √öltimo mensaje\n- Contador de no le√≠dos\n- Estado del bot\n- Paginaci√≥n"
					}
				},
				{
					"name": "Mensajes de Conversaci√≥n",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/messages/conversation/1?limit=50&offset=0",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"messages",
								"conversation",
								"1"
							],
							"query": [
								{
									"key": "limit",
									"value": "50"
								},
								{
									"key": "offset",
									"value": "0"
								}
							]
						},
						"description": "Obtiene todos los mensajes de una conversaci√≥n espec√≠fica.\n\n**Tipos de mensaje:**\n- `contact`: Del contacto\n- `client`: Manual del cliente\n- `bot`: Autom√°tico del bot\n\n**Cambiar el ID en la URL por el conversation_id real**"
					}
				},
				{
					"name": "Marcar como Le√≠da",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/messages/conversation/1/read",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"messages",
								"conversation",
								"1",
								"read"
							]
						},
						"description": "Marca todos los mensajes de una conversaci√≥n como le√≠dos.\n\n**Cambiar el ID en la URL por el conversation_id real**"
					}
				},
				{
					"name": "Buscar Mensajes",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/messages/search?q=hola&limit=20&offset=0",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"messages",
								"search"
							],
							"query": [
								{
									"key": "q",
									"value": "hola",
									"description": "T√©rmino de b√∫squeda (requerido)"
								},
								{
									"key": "limit",
									"value": "20",
									"description": "N√∫mero de resultados"
								},
								{
									"key": "offset",
									"value": "0",
									"description": "Desplazamiento"
								},
								{
									"key": "conversation_id",
									"value": "",
									"description": "Buscar solo en una conversaci√≥n",
									"disabled": true
								}
							]
						},
						"description": "Busca mensajes por contenido de texto en todas las conversaciones del cliente."
					}
				},
				{
					"name": "Estad√≠sticas de Mensajes",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/messages/stats?period_hours=24",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"messages",
								"stats"
							],
							"query": [
								{
									"key": "period_hours",
									"value": "24",
									"description": "Per√≠odo en horas para estad√≠sticas"
								}
							]
						},
						"description": "Obtiene estad√≠sticas detalladas de mensajes:\n- Total de mensajes\n- Mensajes manuales vs bot\n- Mensajes recibidos\n- Conversaciones activas\n- Mensajes no le√≠dos"
					}
				},
				{
					"name": "Health Check - Messages",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/messages/health",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"messages",
								"health"
							]
						},
						"description": "Verifica el estado del m√≥dulo de mensajes y servicios relacionados."
					}
				}
			],
			"description": "Endpoints para gesti√≥n completa de mensajes, conversaciones y b√∫squedas."
		},
		{
			"name": "üìä HEALTH CHECKS Y MONITOREO",
			"item": [
				{
					"name": "Health Check General",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/health",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"health"
							]
						},
						"description": "Health check general del servidor:\n- Estado del servidor\n- Tiempo de actividad\n- Timestamp actual\n- Entorno de ejecuci√≥n"
					}
				},
				{
					"name": "Test de Conectividad",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/",
							"host": [
								"{{base_url}}"
							],
							"path": [
								""
							]
						},
						"description": "Test b√°sico de conectividad al servidor."
					}
				}
			],
			"description": "Endpoints para monitoreo y diagn√≥stico del sistema."
		},
		{
			"name": "üß™ TESTING Y DESARROLLO",
			"item": [
				{
					"name": "Test Completo del Sistema",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Test automatizado completo",
									"pm.test('Sistema funcionando', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Respuesta v√°lida', function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('success');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/auth/profile",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"profile"
							]
						},
						"description": "Test r√°pido para verificar que el sistema est√© funcionando correctamente."
					}
				},
				{
					"name": "Flujo Completo WhatsApp",
					"item": [
						{
							"name": "1. Conectar",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}"
									}
								],
								"url": {
									"raw": "{{base_url}}/api/whatsapp/connect",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"whatsapp",
										"connect"
									]
								}
							}
						},
						{
							"name": "2. Obtener QR",
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}"
									}
								],
								"url": {
									"raw": "{{base_url}}/api/whatsapp/qr/{{client_code}}",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"whatsapp",
										"qr",
										"{{client_code}}"
									]
								}
							}
						},
						{
							"name": "3. Verificar Estado",
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}"
									}
								],
								"url": {
									"raw": "{{base_url}}/api/whatsapp/status",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"whatsapp",
										"status"
									]
								}
							}
						},
						{
							"name": "4. Enviar Mensaje",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}"
									},
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"to\": \"5491123456789\",\n  \"message\": \"Test desde Postman üöÄ\",\n  \"isBot\": false\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/whatsapp/send-message",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"whatsapp",
										"send-message"
									]
								}
							}
						}
					],
					"description": "Secuencia completa para probar WhatsApp:\n1. Conectar\n2. Obtener QR\n3. Escanear con tel√©fono\n4. Verificar estado\n5. Enviar mensaje de prueba"
				}
			],
			"description": "Requests para testing y desarrollo del sistema."
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Script global que se ejecuta antes de cada request",
					"console.log('üöÄ Ejecutando request:', pm.info.requestName);",
					"",
					"// Verificar que las variables est√©n configuradas",
					"if (!pm.environment.get('base_url')) {",
					"    console.log('‚ö†Ô∏è Configura la variable base_url');",
					"}",
					"",
					"if (!pm.environment.get('client_code')) {",
					"    console.log('‚ö†Ô∏è Configura la variable client_code');",
					"}"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Script global que se ejecuta despu√©s de cada request",
					"console.log('‚úÖ Response status:', pm.response.code);",
					"",
					"// Log de errores autom√°tico",
					"if (pm.response.code >= 400) {",
					"    console.log('‚ùå Error response:', pm.response.text());",
					"}"
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:3002",
			"type": "string"
		},
		{
			"key": "client_code",
			"value": "CLI001",
			"type": "string"
		},
		{
			"key": "password",
			"value": "demo123456",
			"type": "string"
		},
		{
			"key": "access_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "refresh_token",
			"value": "",
			"type": "string"
		}
	]
}
